---
categories: algorithm
layout: post
---

- Table
{:toc}

# 单调增斜率优化

首先让我们来考虑下面问题：

要求求解$f(n)$，其中$f$定义如下：


$$
f(i)=\Bigg\{
\begin{array}{ccc}
0&,i=0\\
\min\{h(j)-s(i)s(j)|0\leq j <i\}&,i\ge 1
\end{array}
$$


其中h是一个已知函数，而s是一个严格递增函数。这里我们简单记$r(j,i)=f(j)+h(j)-s(i)s(j)$。

可以很轻松地给出一个$O(n^2)$时间复杂度的算法，但是假如你学会了斜率优化，那就能将时间复杂度降低为$O(n)$。

假设存在$k<j<i$，且$r(j,i)\leq r(k,i)$，那么我们可以推得：

$$
r(j,i)
\leq 
r(k,i)\\
\Rightarrow
h(j)-s(i)s(j)
\leq
h(k)-s(i)s(k)\\
\Rightarrow
h(j)-h(k)
\leq
s(i)(s(j)-s(k))\\
\Rightarrow
\frac{h(j)-h(k)}{s(j)-s(k)}\leq s(i)
$$

看着上面公式是不是有点眼熟？让我们记Y(i)=h(i)，记X(i)=s(i)，那么带入上面公式得到：


$$
r(j,i)
\leq 
r(k,i)\\
\Rightarrow
\frac{Y(j)-Y(k)}{X(j)-X(k)}
\leq
s(i)
$$

这时候应该认出来了吧，这就是我们的斜率公式，即不等式的左边表示的是从$(X(k),Y(k))$出发到点$(X(j),Y(j))$的直线斜率。这里我们简单记$g(k,j)=\frac{Y(j)-Y(k)}{X(j)-X(k)}$。

注意我们两个公式是以等价的方式推导出来的，即$r(j,i)\leq r(k,i)$当且仅当$g(k,j)\leq s(i)$成立。

假设存在三个点$t<k<j<i$，且$g(t,k)\geq g(k,j)$，那么我们可以发现，如果$r(k,i)\leq r(t,i)$，这意味着$g(t,k)\leq s(i)$，但是考虑到$g(k,j) \leq g(t,k)$，因此可知$g(k,j)\leq s(i)$，从而推出$r(j,i) \leq r(k,i)$。换言之，$f(i)$永远拥有比$r(k,i)$更好的选择，因此我们可以在计算$f(i)$时不考虑$f(k)$。

由于之前推出的结论，我们发现真正需要被考虑的点$(X(i_1),Y(i_1)),(X(i_2),Y(i_2)),\ldots$，其必然有斜率递增的特性，即$g(i_{m-1},i_{m})\leq g(i_{m},i_{m+1})$。因此我们只需要利用一个双端队列维护一个斜率递增的点集，考虑到$s(i)$严格增的性质，我们就可以在$O(n)$的时间复杂度内计算$f(1),\ldots ,f(n)$。

# 单调减斜率优化

我们将上面的min换成max后，得到类似的公式：


$$
f(i)=\Bigg\{
\begin{array}{ccc}
0&,i=0\\
\max\{h(j)-s(i)s(j)|0\leq j <i\}&,i\ge 1
\end{array}
$$


可以推出:


$$
r(j,i)
\geq 
r(k,i)\\
\Rightarrow
\frac{Y(j)-Y(k)}{X(j)-X(k)}
\geq
s(i)
$$
同理可以得出我们需要维护的单调队列是单调递减的。
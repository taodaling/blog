---
categories: algorithm
layout: post
---

- Table
{:toc}

# 图计数

## 树

**题目1：给定$n$个顶点，问这$n$个顶点给定的无根树数目。结果模素数$p$。**

根据prufer编码与树唯一对应关系可知，只需要统计它们的prufer编码数目。prufer编码的长度为$n$，其中每个元素均可以为$1$到$n$之间的任意值，因此答案为$n^{n-2}$。这个答案对于$n=1$的情况也是成立的。

时间复杂度为$O(\log_2n)$。

**题目2：给定$n$个顶点。问这$n$个顶点给定的有根树数目。结果模素数$p$。**

题目1给出了无根树的数目为$n^{n-2}$，由于每个无根树都可以视作$n$个不同的有根树，因此有根树的数目为$n^{n-2}\times n=n^{n-1}$。

时间复杂度为$O(\log_2n)$。

## 函数图

考虑任意函数$f:S\rightarrow S$，其中$S=\[1,n\]$。它的函数图如下：建立$n$个顶点，对于$1\leq i\leq n$，从$i$向$f(i)$加入一条有向边。

简单来看，可以发现函数图具有如下性质：

- 每个顶点的出度正好为$1$。
- 每个连通块正好有一个环。
- 每个函数图和$S\times S$上的函数唯一对应。

**题目1：给定$n$，问存在多少个不同的大小为$n$函数图。将结果对某个素数$p$取模。**

可以直接统计函数数目，答案为$n^n$。

时间复杂度为$O(\log_2n)$。

**题目2：给定$n$，要求存在多少大小为$n$的函数图，满足图连通（将有向边视作无向边后连通）。答案对某个素数$p$取模。**

在图连通的前提下，图实际上是一颗树加上一条边。当然树是无向边，而函数图是有向边，但是可以发现我们将函数图中唯一的环缩点后，并将这个顶点作为根，将树边全部从孩子指向父亲，就可以唯一恢复成函数图。因此可以发现函数图的数量和这样的树加上额外的一条边得到的图数量是相同的。

这里我们可以简单的枚举环的长度。考虑环的长度为$i$，那么缩点后共有$n-i+1$个顶点，其对应的生成树的数目为$n^{n-i-1}$，注意这里之所以底数是$n$而不是$n-i+1$，是因为我们如果缩点每次出现在prufer编码中，会使得它的度数增加$1$，我们需要考虑这条边具体连接到缩点前的哪个顶点，因此总的可能数是$n-i+i=n$。同样如果prufer中一个顶点出现次数为$x$，则其度数为$x+1$，因此我们还需要额外乘上一个$i$。并且我们还需要考虑环中的元素和其排列，因此总数为：

$$
\sum_{i=1}^n{n \choose i}\times (i-1)!\times i\times n^{n-i-1}
$$

上面我们可以$O(n)$计算出结果。

**题目3：给定$n$，对于$k=1,2,\ldots,n$，问存在多少不同的函数图，正好有$k$个连通块。将结果对某个素数$p$取模。**

提供一道[题目](https://cses.fi/problemset/task/2415)。

我们可以利用题目2计算单个连通块的技术加上DP，这样可以得到一个$O(n^3)$的算法。

但是我们实际上可以将算法优化到$O(n^2)$，方案如下。

我们先考虑只有一个连通块的情况，就是

$$
\sum_{i=1}^n{n \choose i}\times (i-1)!\times i\times n^{n-i-1}
$$

这里我们可以稍微修改一下流程，我们考虑在环中的元素数目为$i$，则其方案数为：

$$
{n \choose i}\times i\times n^{n-i-1}
$$

之后我们将选中的$i$个元素拆分成$k$个非空环，这样就能得到结果。方案数可以通过无符号第一类斯特林数得到。因此对于给定的$k$，答案为：

$$
\sum_{i=1}^n{n \choose i}\times i\times n^{n-i-1}\times
\left[
\begin{array}{}
i\\
k
\end{array}
\right]
$$

对于特定的$k$，可以$O(n)$算出。总的时间复杂度为$O(n^2)$。

## 生成树

**题目1：给定$n$个顶点$m$条边的无向（有向）图，计算对应的生成树数目。答案对某个素数取模。**

矩阵树定理的基础应用。

时间复杂度为$O(n^3+m)$。

## 欧拉路径

**题目1：给定$n$个顶点$m$条边的有向图，计算对应的欧拉环路数目。答案对某个素数取模。**

BEST定理的应用。

时间复杂度为$O(n^3+m)$。

**题目2：给定$n$个顶点，顶点$i$到$i+1\mod n$有一条无向边$i$。给定$a_0,a_1,\ldots,a_{n-1}$，要求计算存在多少条环路，满足经过边$i$正好$a_i$次。结果对素数取模。其中$$**

提供一道[题目](https://atcoder.jp/contests/agc051/tasks/agc051_d)。

考虑边$i$，我们记其正向经过次数为$x_i$，逆向经过次数为$y_i$。将每条边正向逆向出现次数相消后，图应该依旧满足欧拉环路的定理才有意义。此时每个顶点的入度出度相等，可以发现每条边$i$的正向或逆向经过次数均为某个数$k$。

我们可以大力枚举这个数$k$，正向和逆向各需要枚举一次。之后边$i$剩余正向和逆向经过次数为$(a_i-k)/2$。这时候图是有向图，我们可以用题目1的方式计算有向图的欧拉迹数目。每次计算的时间复杂度为$O(k^3)$。总的时间复杂度为$O(k^3\sum_{i}a_i)$。

# 序列计数

## 相邻不同序列

**题目1：有$n$个球，第$i$个球的颜色为$c_i$。要求统计有多少不同的排列，满足排列中任意两个相邻的球的颜色不同，将结果模素数$p$后输出。其中$\leq n\leq 10000$，且$1\leq c_i\leq n$**

提供一道[题目](https://cses.fi/problemset/task/2421)。

记录$C_i$表示颜色为$i$的球的出现次数。首先我们可以预先认定同色球在最终序列中的出现顺序。之后记录集合$A_{i,j}$表示颜色为$i$的球，第$j$个出现的球和第$j+1$出现的球紧密相连的序列集合。则我们要求的是

$$
|\cap_i\cap_{1\leq j\lt C_i}\overline{A_{i,j}}|=|S|-|\cup_i\cup_{1\leq j\lt C_i}A_{i,j}|
$$

接下来就是一个简单的容斥，可以展开为：

$$
\sum_{X\lt C}[(-1)^{\sum X}][\prod_i{C_i-1\choose X_i}] [\frac{(n-\sum X)!}{\prod_{i}(C_i-X_i)!}]
$$

这个公式可以化为多个生成函数的乘积。其中

$$
P_i=\sum_{j=0}^{C_i-1}(-1)^j{C_i-1\choose j}\frac{1}{(C_i-j)!}x^j
$$

记它们的乘积为$Q=\sum_{i}q_ix^i$。则结果为$\sum_{i}q_i(n-i)!$。

上面的算法的时间复杂度为$O(n(\log_2n)^2)$。当然如果你用一般的DP也可以做到$O(n^2)$。

# 集合计数

## 分组问题

**题目1：将$n$个编号的球放入$m$个带编号的篮子里，有多少种放法。**

每个球有$m$种放法，且不同的球的方法是独立的，因此结果为$m^n$。

**题目2：将$n$个未编号的球放入$m$个带编号的篮子里，有多少种放法。**

记$x_i$表示第$i$个篮子里的球数，此时有$x_1+x_2+\ldots+x_m=n$成立。这个可以用隔板法解决，答案是${n+m-1\choose m-1}$。

**题目3：将$n$个带编号的球放入$m$个未编号的篮子里，有多少种放法。**

可以将篮子先编上号，可以发现此时答案是$m^n$。之后我们发现每种真实的方案对应$m!$种编号后的方案，因此答案是$\frac{m^n}{m!}$。

**题目4：将$n$个带编号的球放入$m$个未编号的篮子里，且要求每个篮子不空，有多少种放法。**

这实际上是第二类斯特林数，答案是$\begin{Bmatrix}n\\m\end{Bmatrix}$。

**题目5：将$n$个未编号的球放入$m$个未编号的篮子里，有多少种放法。**

可以用动态规划求解。记$dp(i,j,k)$表示每个篮子最多放$i$个球，共$j$个篮子，放$k$个球的方案，这个dp可以$O(n^2m)$求解。
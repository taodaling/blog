---
categories: math
layout: post
---

- Table
{:toc}
# 原根

若正整数a与m互质，由欧拉定理知道存在某个正整数d，满足$a^d=1\mod m$，比如令d为 欧拉函数$\varphi(m)$。在所有满足上述条件的d中最小的可能取值记作$\delta_m(a)$，由于$\delta_m(a)\leq \varphi(m)$，若等号成立，则成a是模m的原根。

存在模m的原根，当且仅当m为下列形式：$2$，$4$，$p^a$，$2p^a$。这里p是奇素数，a为正整数。

要找模m最小的原根，我们知道对于任意数a，都有$\delta_m(a)\|\varphi(m)$。因此我们可以先找到$\varphi(m)$的所有素数因子$p_1,p_2,\ldots,p_k$。根据资料，模p的最小原根应该是$m^{\frac{1}{4}}$级别的，因此可以直接暴力从小到大枚举所有可能的原根。当我们枚举到a时，如果a不是原根，那么至少存在一个数$1\leq i \leq k$，使得$\delta_m(a)\|\frac{\varphi(m)}{p_i}$。此时必定有$a^{\frac{\varphi(m)}{p_i}}=1$。因此我们可以通过这个条件来辨别一个数是否是原根。

# 二次剩余

在数论中，一个整数x对于p的二次剩余是指$x^2\mod p$，如果一个数$y$可以表示$x^2\mod p$，那么称y是模p的**二次剩余**，否则称y是模p的**二次非剩余**。

如果p是素数，考虑到$$a^2=b^2\Rightarrow (a-b)(a+b)=0$$，因此可以认为在模p的剩余类环中有$\frac{p-1}{2}$个二次剩余（不考虑0），同时也有$\frac{p-1}{2}$个二次非剩余。

# 欧拉准则

当p是素数时，要判断一个数y是否是模p的二次剩余，可以借助欧拉准则。

**一个数y是模p的二次剩余，当且仅当$y^{\frac{p-1}{2}}=1\mod p$。**

# Toneli-Shanks算法

Toneli-Shanks算法可以用于求解$x^2=y\mod p$，这里p是素数，y已知，求x。算法流程如下：

首先我们需要先通过欧拉准则确定有解。假如有解，我们随机一个a，满足$w=a^2-n$是二次非剩余。之后我们证明$x=(a+\sqrt{w})^{\frac{p+1}{2}}$。

证明：


$$
x=(a+\sqrt{w})^{\frac{p+1}{2}}\\
\Rightarrow x^2=(a+\sqrt{w})^{p+1}=(a+\sqrt{w})^p(a+\sqrt{w})
$$


利用二项式展开：


$$
(a+\sqrt{w})^p=\sum_{i=0}^p{p\choose i}a^i(\sqrt{w})^{p-i}
$$


由于${p\choose i}$仅在$i$为0或p时有非0值（在模p的意义下）。因此可以简化得到


$$
(a+\sqrt{w})^p=a^p+(\sqrt{w})^p=a+\sqrt{w}
$$


之后代入之前的公式得到


$$
x^2=(a+\sqrt{w})(a-\sqrt{w})=a^2-w=n
$$



知道了正确性后，现在还有一个问题$\sqrt{w}$不存在啊，怎么求解出$x$呢，实际上复数中虚数$i=\sqrt{-1}$也是不存在的啊，可以效仿它的方案，我们可以将$\sqrt{w}$表示为虚部，之后利用快速幂乘法来得到$x$，之后取实部就好了。

这个算法的时间复杂度取决于a选择的次数，考虑到我们在二次剩余那节说过1~p之间的二次剩余和二次非剩余是相同数量的，这里可以简单认为取到w为非二次剩余的概率为$1/2$，因此期望次数为2，故时间复杂度应该为$O(\log_2p)$。

# 参考文献

- [原根wiki](https://zh.wikipedia.org/wiki/%E5%8E%9F%E6%A0%B9)
- [二次剩余wiki](https://zh.wikipedia.org/wiki/%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99)
- [欧拉准则wiki](https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%86%E5%88%99)
- [原根oi wiki](https://oi-wiki.org/math/primitive-root/)
- [Tonelli-Shanks算法](https://en.wikipedia.org/wiki/Tonelli%E2%80%93Shanks_algorithm)

- [证明Tonelli-Shanks算法的简短博客](https://blog.csdn.net/philipsweng/article/details/50000903)
---
layout: post
categories: algorithm
---

- Table
{:toc}
# 矩阵树定理

## 行列式

先回忆下行列式的定义。

对于一个1~n的排列p，其中逆序对的数目记作$\delta(p)$。

记1~n的所有排列的集合为$P_n$，记排列$p$的第$i$个元素为$p_i$。

**方阵的行列式定义为**


$$
|A|=detA=\sum_{p\in P_n}\delta(p)\prod_{i=1}^nA_{ip_i}
$$


通过定义求行列式值的时间复杂度为$O(n!)$，在n较大时是不可行的。由于矩阵i行加上j行乘上某个常数，不会改变矩阵的行列式值，因此我们可以利用高斯消元法将矩阵转换为上三角矩阵，再通过计算对角线元素的乘积和得到行列式值，时间复杂度为$O(n^3)$。



## 矩阵树定理

设G是一个有n个顶点的无向图，定义度数矩阵$D(G)$为：


$$
D_{ii}(G)=\deg(i),D_{ij}=0,i\neq j
$$


定义$e(i,j)$为点i与点j之间边的数目，定义邻接矩阵$A$为：


$$
A_{ij}(G)=e(i,j)
$$



定义拉普拉斯矩阵$L$为：


$$
L(G)=D(G)-A(G)
$$




记图G的生成树个数为$t(G)$。



**命题1：L(G)的行列式值为0。**

证明:

L(G)所有列的和都是0，因此矩阵的行向量是线性相关的，故矩阵的秩小于n，矩阵的行列式值为0。

记$A/i$表示矩阵A删除第i行i列得到的n-1阶主子式。

**命题2：如果G是不连通的，那么L(G)的n-1阶主子式的行列式值为0。**

图G至少可以分为两个连通分块$G_1$,$G_2$，设$G_1$中含有$m$个顶点。我们将其$L(G)$行列式化作如下形式：


$$
\left|
\begin{array}{ccc}
|L(G_1)/m| & 0\\
0 & |G_2|
\end{array}
\right|=\sum_{p\in P_{m-1}}\delta(p)\prod_{i=1}^{m-1}A_{ip_i}|G_2|=0
$$



**命题3：如果G是一个树，那么L(G)的任意n-1阶主子式为行列式值为1。**

当G只有两个顶点的时候，命题很显然成立。

利用归纳法，假设命题在G少于n个时始终成立，现在考虑G正好有n个顶点的时候的情况。

将顶点1视作根，设x任意一个叶结点，y是x的父亲。我们通过换行换列将第x行（列）和第n行（列）交换，将y行（列）与n-1行（列）交换。由于是偶数次交换，因此行列式值不变。此时行列式形式如下：


$$
\left|
\begin{array}{ccc}
\ldots & \ldots & \ldots & 0\\
\ldots & \ldots & \ldots & \ldots\\
\ldots & \ldots & \ldots & -1\\
0 & \ldots & -1 & 1
\end{array}
\right|
$$



删除第n行n列后的行列式值后得到的$L(G)/n$，为图G删除了顶点x后新图$G'$，除了y的度数额外多1。


$$
|L(G)/n|=|L(G')|+|L(G')/n-1|=0+1=1
$$



**定理1：对于任意1<=r<=n，L(G)移除后第r行r列后得到的n-1阶主子式$L(G)/r$的行列式绝对值等于$t(G)$**



我们观察矩阵B，矩阵B为n行m列矩阵，n是图的点数，m是图的边数。初始时B全为0，之后对于边$e_j=(u,v)$，我们将$B_{uj}$和$B_{vj}$一个设为1，一个设为-1，顺序不重要。

之后我们考虑$BB^T$，对于$i\neq j$其第i行第j列的值是$B$的第i行和第j行的点积，为点i和点j之间边的数目取反。当$i=j$时，其值为点i的度数。

同理可得$\|L(G)/r\|=\|(B/r)(B/r)^T\|$。根据Binet-Cauchy公式可以得到：
$$
|L(G)/r|=|(B/r)(B/r)^T|=\sum_{x\in E,|x|=n-1}|B_{1..n,x}/r||(B_{1..n,x}/r)^T|\\
=\sum_{x\in E,|x|=n-1}|B_{1..n,x}/r|^2
$$


上面的$B_{1..n,x}$是指B的1~n行，x列的子矩阵。$|B_{1..n,x}/r|$是1当且仅当x形成G的生成树，否则均为0。

因此定理得证。





# 参考文献

[https://oi-wiki.org/graph/matrix-tree/](https://oi-wiki.org/graph/matrix-tree/)

《生成树的计数和应用》
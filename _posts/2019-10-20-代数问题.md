---
categories: algorithm
layout: post
---

- table
{:toc}
# 拉格朗日定理

拉格朗日定理：对于任意有限群$G$以及其某个子群$H$，都有
$$
|G|
$$
能被
$$
|H|
$$
整除。

证明：

当$G=H$时，定理显然成立，下面考虑$G\neq H$，此时有$\|H\|<\|G\|$。

考虑$H$在$G$中的补集中的任意元素$x_1$，我们构建$H$的左陪集：

$$
x_1H=\{x_1*h|h\in H\}
$$
。

下面我们证明$H$的这些左陪集与$H$的交集为空，假设存在交集，即：

$$
h_i=x_1*h_j
$$
，那么我们可以直接推出：
$$
x_1=h_i*h_j^{-1}\in H
$$
，而这与$x_1$不属于$H$的前提相悖，因此证明完成。

如果$H$与$xH$的并集不等于$G$，那么就存在额外的元素$x_2$，落在$H$和$xH$之外。于是我们继续构建$H$的左陪集$x_2H$。

重复这个流程，直到得到左陪集与$H$的并集等于$G$为止。假设这时候我们得到的左陪集为$x_1H,x_2H,\ldots, x_kH$。

下面我们证明这些左陪集也是互不相交的，假设$x_iH$与$x_jH$（$i < j$）交集非空，那么有：
$$
x_ih_i=x_jh_j\Rightarrow x_j=x_ih_ih_j^{- 1}\Rightarrow x_j\in x_iH
$$

，这与我们之前的
$$
x_j \notin x_iH
$$
前提相悖，因此证明成立。

可以发现这k个左陪集与$H$都拥有$\|H\|$个元素，且互不相交，且并为$G$。因此可以得出：
$$
(k+1)|H|=|G|
$$
，因此$\|H\|$能够整除$\|G\|$，命题成立。

# $rank(A^TA)=rank(A)$

对于任意$m\times n$矩阵$A$,都有$rank(A^TA)=rank(A)$。

证明：

考虑对于$A^TA$零空间中的向量$x$，有

$$
A^TAx=0\\
\Rightarrow x^TA^TAx=0\\
\Rightarrow (Ax)^T(Ax)=0\\
\Rightarrow \|Ax\|^2=0\\
\Rightarrow Ax=0
$$

因此，$A^TA$和$A$具有相同的零空间，$A$的零空间的秩为$rank(N(A))$，那么$A^TA$的秩为$rank(A^TA)=m-rank(N(A))=rank(A)$。

# $A^TA$是非奇异矩阵当且仅当A的列向量线性无关

$A^TA$是非奇异矩阵，当且仅当A的列向量线性无关。

证明:

由于$m=rank(A^TA)=rank(A)$，因此当$A$的列向量线性无关。

# AB与BA特征值相同

**对于两个方阵$A$，$B$，我们始终有$AB$和$BA$的特征值相同。**

证明：

设$\lambda$是$AB$的任意特征值，$x$是$AB$的特征值为$\lambda$的特征向量。

$$
ABx=\lambda x\\
\Rightarrow BABx=\lambda Bx\\
\Rightarrow (BA)(Bx)=\lambda (Bx)
$$

这意味着$\lambda$同时也是$BA$的特征值，而$Bx$是$BA$的特征值为$\lambda$的特征向量。

# 实对称矩阵特征向量两两正交

考虑对称矩阵$A$，以及其某个特征向量$x$和$y$。有

$$
Ax=\lambda_1x\\
Ay=\lambda_2y
$$

将第一个式子的左右两端都乘上$y^T$，可以得到：

$$
y^TAx=\lambda_1y^Tx\\
\Rightarrow \lambda_2 y^Tx=\lambda_1 y^Tx
$$

这意味着，$\lambda_1\neq \lambda_2\Rightarrow y^Tx=0$。

# $n\times n$实对称矩阵拥有$n$个正交特征向量

证明：

待补充。

# 奇异值分解存在性证明

奇异值分解是指对于任意$n\times m$矩阵$A$，我们都能将其分解为如下形式$A=U\Sigma V^T$的形式，其中$U$和$V$是标准正交矩阵，而$\Sigma$是对角线矩阵。

首先我们对矩阵$A^TA$做奇异值分解，得到$A^TA=V\Lambda V^T$，因此我们直接得到了一个标准正交矩阵。接下来我们证明两个$V$中的正交向量列$v_i$和$v_j$在$A$的线性变换下依旧正交。

$$
(Av_i)^T(Av_j)=v_i^T(A^TAv_j)=v_i^T\lambda v_j=\lambda v_i^Tv_j=0
$$

因此我们得到了正交矩阵$AV$。但是这里$AV$不一定是标准化的。我们可以将$AV$右乘一个对角矩阵帮助其标准化：

$$
AV\Sigma^{-1}=U\\
\Rightarrow AV=U\Sigma\\
\Rightarrow A=U\Sigma V^-1 \\
\Rightarrow A=U\Sigma V^T
$$

# AGC006C

**题意**

[https://atcoder.jp/contests/agc006/tasks/agc006_c](https://atcoder.jp/contests/agc006/tasks/agc006_c)

**题解**

考虑$a_i$发生变化，容易推出发生变化后的期望值为：
$$
E[a_i']=E[a_{i+1}]+E[a_{i-1}]-E[a_i]
$$
。

之后我们来理解形如
$$
b'=a+c-b
$$
等式的几何含义。

考虑一个数轴，我们在$a$、$b$、$c$、$b'$处各放了一个顶点，记作$A$，$B$，$C$，$B'$。

可以发现：
$$
b'-a=c-b\\
c-b'=b-a
$$

这意味着操作$a_i$会导致$a_i$到$a_{i-1}$以及$a_{i+1}$到$a_i$的距离交换了。

因此假如我们维护的不是每个顶点的具体位置，而是形如$d_i=a_i-a_{i-1}$的差量，那么一次变换可以简单的表示为
$$
swap(d_i,d_{i+1})
$$
。因此我们需要做的实际上是维护一个置换，之后对置换进行k次幂运算，最后重新排列d，进而计算出最终位置。

# 两个相似矩阵的特征多项式相同

证明非常简单，设$P$为某个可逆矩阵，$A$为某个方阵。那么

$$
|xI-PAP^{-1}|
=|PxP^{-1}-PAP^{-1}|\\
=|P(xI-A)P^{-1}|=|P|\cdot|xI-A|\cdot |P^{-1}|\\
=|xI-A|
$$

# 特征多项式

考虑某个交换环$R$上的$n\times n$矩阵$A$，我们定义它的特征多项式为：$f(x)=\|xI-A\|$，其中$x\in R$。考虑到行列式的定义，显然$A$的特征多项式是$n$阶多项式。

要计算$A$的特征多项式，我们可以用插值法，找出特征多项式在$0,1,2,\ldots n$的取值，之后用插值法插出多项式即可。后面的步骤需要的时间为$O(n^2)$，因此瓶颈在于如何快速得到特征多项式在$O(n)$个点的取值。

由于两个相似矩阵的特征多项式相同，因此我们可以通过计算$A$的某个相似矩阵来加速行列式的计算。由于每个矩阵都相似与某个上海森堡矩阵相似，因此我们可以将$A$化为某个上海森堡矩阵，上海森堡矩阵长相为：

$$
\left(
\begin{array}{cccccc}
a_{1,1} & a_{1,2} & a_{1,3} & \ldots & a_{1,n-1} & a_{1,n}\\
a_{2,1} & a_{2,2} & a_{2,3} & \ldots & a_{2,n-1} & a_{2,n}\\
0 & a_{3,2} & a_{3,3} & \ldots & a_{3,n-1} & a_{3,n}\\
0 & 0 & a_{4,3} & \ldots & a_{4,n-1} & a_{4,n}\\
0 & 0 & 0 & \ldots & a_{5,n-1} & a_{5,n}\\
\ldots & \ldots & \ldots & \ldots & \ldots & \ldots\\
0 & 0  & 0 & \ldots & a_{n,n-1} & a_{n,n}

\end{array}
\right)
$$

即对于任意$i>j+1$，都有$a_{i,j}=0$。

花费$O(n^3)$时间复杂度就可以将$A$化为上海森堡矩阵。

接下来我们直接认为$A$是一个上海森堡矩阵。容易发现通过消元法求$f(x)$，其中$x$是给定值，所需要的时间复杂度仅为$O(n^2)$。因此计算$f$在$O(n)$个点上的特征函数值需要的总时间复杂度为$O(n^3)$。

这里总的时间复杂度为$O(n^3)$。

# Cayley-Hamilton定理

任意交换环上的方阵$A$和其特征多项式$f$，都满足$f(A)=0$。

# 特征多项式与矩阵快速幂

要求计算$n\times n$矩阵$A$的$k$次幂$A^k$，其中$n\leq 50$，$k\leq 2^{10000}$。

直接上矩阵快速幂，时间复杂度为$n^3\log_2k$，如果$k$小点还是有机会的，但是不好意思，过不了。

现在我们用特征多项式来加速。

我们先以$O(n^3)$的时间复杂度算出$A$的特征多项式$f$，之后利用Cayley-Hamilton定理可以发现：

$$
A^k=A^k\mod f(A)
$$

而这里$f$是$n$阶多项式。我们可以先计算出$x^k\mod f(x)$，之后用$A$代入$x$即可。

定义$g(i)=A^i \mod f(A)$，那么我们可以利用下面的发现进行快速幂算出$A^k$。

$$
g(i)=g(\lfloor \frac{i}{2} \rfloor)^2x^{i\mod 2}
$$

这里我们需要处理的是多项式卷积和除法，我们可以利用快速卷积进行加速（如果要求计算的是取模结果，且模数不是很好的情况下，可以选择暴力计算），那么时间复杂度为$O(n\log_2n\log_2k)$（暴力的情况下为$O(n^2log_2k)$）。

之后我们得到的是$g(k)$，其代表的是一个$n-1$阶的多项式，我们可以将$A$代入得出最终结果，这里的时间复杂度为$O(n^4)$。

因此总的时间复杂度从$O(n^3\log_2k)$优化到了$O(n^4+n\log_2n\log_2k)$（暴力的情况下为$O(n^4+n^2log_2k)$）。

# 特征多项式与递推数列

现在考虑一个问题，存在一个数列$\{x_i\}$，我们已知前$n$项$x_0,x_1\ldots,x_{n-1}$,已知一种递推关系

$$x_i=\sum_{j=1}^na_jx_{i-j}$$

要求我们计算$x_k$，其中$k\leq 10^9$，$n\leq 1000$。

我们可以用矩阵运算来表示线性递推关系，建立一个矩阵

$$
A=
\left(
\begin{array}{c}
a_1 & a_2 & a_3 & \ldots & a_{n-1} &a_n \\
1 & 0 & 0 & \ldots & 0 & 0\\
0 & 1 & 0 & \ldots & 0 & 0\\
0 & 0 & 1 & \ldots & 0 & 0\\
\ldots &\ldots &\ldots &\ldots &\ldots & \ldots \\
0 & 0 & 0 & \ldots & 1 & 0\\
\end{array}
\right)
$$

同时建立输入向量：

$$
x=
\left(
\begin{array}{c}
a_{n-1}\\
a_{n-2}\\
\ldots\\
a_1\\
a_0
\end{array}
\right)
$$

那么就有：

$$
x_k=(A^kx)(1)
$$

现在我们将问题转换为，存在一个$n\times n$矩阵$A$，我们希望求解$A^kx$，其中$x$是长度为$n$的列向量，$n\leq 1000$，$k\leq 2^{10000}$。

在特征多项式与矩阵快速幂一节中，我们给出了两种时间复杂度$O(n^3\log_2k)$和$O(n^4+n\log_2n\log_2k)$，显然两种都是低效的方式。

下面我们来进行优化整个算法。首先我们需要通过行列式以及插值法来找特征多项式吗，考虑到$A$非常简单，我们可以直接手推出特征多项式：

$$
f(x)=x^n-\sum_{j=1}^na_jx^{n-j}
$$

这样我们就避免了$O(n^3)$时间复杂度的计算特征多项式的流程。

之后由于我们实际上不需要真的得出$A^k$，这只是个中间产物而已。假设我们已经得出了

$$
A^k=c_1A^{n-1}+c_2A^{n-2}+\ldots+c_n \mod f(A)
$$

那么我们直接跳过中间产物的计算，一步到达结果：

$$
(A^kx)(1)\\=(\sum_{i=1}^nc_iA^{n-i}x)(1)\\
=\sum_{i=1}^nc_i(A^{n-i}x)(1)\\
=\sum_{i=1}^nc_ix_{n-i}\\
$$

这里我们避免了计算$A^k$，直接通过计算$x^k \mod f(x)$的系数以$O(n)$的时间复杂度得到了值。

这里总的时间复杂度为$O(n\log_2n\log_2k)$。

# 线性函数和线性递推关系

考虑给定一个$n\times 1$的向量$x$和$n\times n$的方阵$A$，我们希望求$(A^kx)(1)$，其中$k\leq 2^{10000}$，而$n\leq 100$。

首先会想到矩阵加快速幂，时间复杂度为$O(n^3\log_2k)$，但是绝对会超时。下面聊一下如何用特征多项式进行加速计算。

首先设$f(x)$是$A$的特征多项式，那么利用Cayley-Hamilton定理可以推出：

$$
f(A)=A^n+c_1A^{n-1}+c_2A^{n-2}+\ldots+c_n=0\\
\Rightarrow A^n=-c_1A^{n-1}-c_2A^{n-2}-\ldots-c_n\\
\Rightarrow A^{n+t}=-c_1A^{n-1+t}-c_2A^{n-2+t}-\ldots-c_nA^t
$$

我们可以发现序列$\{A^i\}$存在长度不超过$n$的递推关系。

但是问题是该如何找出这递推关系呢？我们可以先搁置这个问题，继续看看利用递推关系，我们是否可以加速计算$(A^kx)(1)$。记$y_i=(A^ix)(1)$，那么利用递推关系，可以得出：

$$
A^{i}=-c_1A^{i-1}-c_2A^{i-2}-\ldots-c_nA^{i-n}\\
\Rightarrow A^{i}x=-c_1A^{i-1}x-c_2A^{i-2}x-\ldots-c_nA^{i-n}x\\
\Rightarrow (A^{i}x)(1)=-c_1(A^{i-1}x)(1)-c_2(A^{i-2}x)(1)-\ldots-c_n(A^{i-n}x)(1)\\
\Rightarrow y_i=-c_1y_{i-1}-c_2y_{i-2}-\ldots-c_ny_{i-n}
$$

我们发现序列$\{y_i\}$也存在长度为$n$的递推关系。而我们要求的就是$y_k$。

剩下的流程实际上就和特征多项式与递推数列这一节的内容一样了。这部分的时间复杂度为$O(n\log_2n\log_2k)$。

现在还剩下最后一个问题，如何找到序列$\{A^i\}$和$\{y_i\}$公共的递推关系呢你可以这样做，计算出$y_0,y_1,\ldots,y_{2n}$，（直接暴力计算，这里需要花费$O(n^3)$的时间复杂度，但是如果矩阵非常稀疏的话，我们实际上可以在$O(n^2)$时间复杂度内计算得出）。之后通过BMerlekamp-Massey算法找出它们之间的最短线性递推关系（对应的就是矩阵$A$的最小多项式）即可。BM算法可以以$O(m^2)$的时间复杂度，找出长度为$m$的数列的最短的线性递推关系。

总的时间复杂度为$O(n^3+n\log_2n\log_2k)$（最优的情况下是$O(n^2+n\log_2n\log_2k)$）。天呐撸。

# Berlekamp Massey算法的应用

要了解BMerlekamp-Massey算法，推荐看一下Massey的[论文](https://pdfs.semanticscholar.org/a087/0e57fb5e59aae83f2a2a09b8df78257ef556.pdf)。

这里只是提一下怎么使用BM算法。

考虑有存在一组长度为$n$的向量序列$v_0,v_1,...$，其中$v_i=Av_{i-1}$，$A$是一个$n\times n$方阵，而$v_0$是给定值。问题要求你求$v_k$的第$t$个元素$v_k(t)$。

一般主流的做法就是对矩阵$A$进行快速幂，这个需要的时间复杂度为$O(n^3\log_2k)$。但是假如$n\leq 1000$呢，该怎么办。假如矩阵比较稀疏，比如我们从$v_i$中得到$v_{i+1}$只需要$O(n)$的时间复杂度的话，我们就可以用下面的方式在$O(n^2\log_2n)$的时间复杂度内得到结果。

另外一种方式就是求矩阵$A$的特征方程，之后利用特征方程进行快速求解，但是求特征方程需要的时间复杂度是$O(n^3)$。

事实上，我们之所以会选择$A$的特征方程，是因为特征方程一定是$A$的零化多项式。而我们在线性函数和线性递推关系一节中已经说过$\{A^i\}$序列满足的线性递推关系，$\{v_i\}$也是满足的，实际上：

$$
A^{i}=-c_1A^{i-1}-c_2A^{i-2}-\ldots-c_nA^{i-n}\\
\Rightarrow A^{i}v_0=-c_1A^{i-1}v_00-c_2A^{i-2}v_0-\ldots-c_nA^{i-n}v_0\\
\Rightarrow v_i=-c_1v_{i-1}-c_2v_{i-2}-\ldots-c_nv_{i-n}
$$

自然$\{v_i(t)\}$也是满足的，

我们可以通过直接计算$\{v_i\}$序列的前面几项$v_0,v_1,\ldots, v_m$，之后利用BM算法在$V(t)=\{v_0(t),v_1(t),\ldots, v_m(t)\}$组成的序列中推出最短线性递推关系，由于$A$的特征方程也一定是该序列的一个递推关系，因此$\{A^i\}$,$\{v_i\}$,$\{v_i(t)\}$的最短线性递推关系最多是$n$项。

那么我们到底该怎么选择$m$，能保证BM推出的线性关系没有问题呢？假设我们用BM算法处理了$m$个数值，之后如果由于最短递推关系不再满足而发生重构，那么重构后的递推关系不小于$\lceil \frac{m+1}{2} \rceil$，但是我们提过整个序列的最短递推关系不会超出$n$项，因此假如我们选择$m=2n$就足够了。

如果我们需要计算整个$v_k$而非仅仅是$v_k(t)$，那么我们就不能使用BM算法了（当然如果你要使用BM算法，那你需要对列向量的每个维度跑一遍BM才行，因为两个维度的线性递推关系可能是不同的）。我们可以通过直接算$A$的特征方程来进行加速，整个过程的时间复杂度是$O(n^3)$，依旧会优于通常的$O(n^3\log_2n)$的做法。

# 线形基的一些问题

**问题1：给定一组数$A=\{a_1,a_2,\ldots,a_n\}$，判断通过异或操作可以得到多少不同的数。**

用这组数构建线性基，记$r$为线性基的大小，每个数都可以表示为线性基中若干个数的异或和，因此结果为$2^r$。

**问题2：给定一组数$A=\{a_1,a_2,\ldots,a_n\}$，判断其中有多少个子集，其异或和为0。**

用这组数构建线性基，记$r$为线性基的大小。所有线性基的非空子集的异或和都必定非0，因此所有异或和为0的子集必定包含不属于线性基中的向量。事实上，我们考虑任意非线性基中向量的子集$S$，记其异或和为$x$，我们必定能找到线性基的某个子集$T$使得其异或和为$x$，这样我们就能确定一个异或和为0的子集$S\cup T$。因此所有子集中异或和为0的子集共有$2^{n-r}$个。
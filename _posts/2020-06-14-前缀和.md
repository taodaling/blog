---
categories: algorithm
layout: post
---

- Table
{:toc}

# 前缀和技术

考虑这样一个问题，给定一个静态数组$a_1,\ldots,a_n$，之后回答$q$个请求，每个请求给出$l,r$，要求计算$\sum_{i=l}^ra_i$。

这种静态询问的问题，可以用前缀和技术来加速，具体做法就是我们维护另外一个序列$b_0,b_1,\ldots,b_n$，其中$b_0$为加法$0$，对于$i\geq 1$，有$b_i=\sum_{j=1}^ia_i=b_{i-1}+a_i$。很显然$b$序列我们可以$O(n)$时间复杂度内求出。之后对于任意询问$\sum_{i=l}^ra_i$，有$\sum_{i=l}^ra_i=b_r-b_{l-1}$。因此对于每个请求我们都可以$O(1)$求解。

当然如果给定序列$b$，我们也可以很容易还原$a$，因为$a_i=b_i-b_{i-1}$。

前缀和技术实际上有点类似于傅里叶变换，将元素转换到另外一个空间中进行求解，从而实现一些操作加速，而另外一些操作减速。这里加速的就是区间和，而减速的就是普通的赋值修改操作（每次修改和赋值的时间复杂度都变成了$O(n)$）。

# 前缀和和区间修改

考虑这样一个问题，给定一个静态数组$a_1,\ldots,a_n$，之后给定$q$个请求，每个请求给出$l,r,x$，要求对所有$l\leq i\leq r$，将$a_i$变成$a_i+x$。在处理完所有请求后，输出$a_1,\ldots,a_n$。

我们也可以对应的用前缀和实现区间修改操作。不妨令$a_1=\ldots=a_n=0$（如果不是，最后加回到结果就可以了）。具体做法就是维护一个修改序列$b_0,\ldots,b_n$，我们保证真实的结果为$a_i=\sum_{j\geq i}b_i$。因此对于修改$l,r,x$，我们只需要将$b_r$增加$x$，同时将$b_{l-1}$减少$x$。因此每个请求我们都可以$O(1)$求解。最后我们用公式可以直接$O(n)$还原出$a$。

# 高维前缀和

现在假设有$k$维矩形，记$f(i_1,\ldots,i_k)$为单元$(i_1,\ldots,i_k)$中的数值。同时记$g(i_1,\ldots,i_k)=\sum_{1\leq j_1\leq i_1, \ldots, 1\leq j_k\leq i_k}f(i_1,\ldots,i_k)$。

要算高维前缀和，我们可以定义$h(i_1,\ldots,i_k,t)=\sum_{1\leq j_t\leq i_t,\ldots,1\leq j_k\leq i_k}f(i_1,\ldots,i_{t-1},j_t,\ldots,j_k)$。于是乎$g(i_1,\ldots,i_k)=h(i_1,\ldots,i_k,0)$。

下面我们来推导$h$，可以发现有：

$$
h(i_1,\ldots,i_k,t)=h(i_1,\ldots,i_t-1,\ldots,i_k,t)+h(i_1,\ldots,i_t,\ldots,i_k,t+1)
$$

因此我们可以花总共$O(kS)$的时间复杂度和空间复杂度求解出结果，其中$S$是矩形的体积。
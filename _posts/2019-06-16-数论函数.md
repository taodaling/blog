---
categories: algorithm
layout: post
---

- Table
{:toc}
# 积性函数

对于定义于正整数集合上的函数$f$，如果对于任意两个互质的正整数$a$，$b$，有$f(ab)=f(a)f(b)$，则称函数$f$为积性函数。

# 完全积性函数

对于定义于正整数集合上的函数$f$，如果对于任意两个正整数$a$，$b$，有$f(ab)=f(a)f(b)$，则称函数$f$为完全积性函数，完全积性函数一定也是积性函数。

# 莫比乌斯函数

下面不讲原理，要看原理可以读《组合数学》这本书。

莫比乌斯函数定义为


$$
\mu(x)=\left\{ \begin{array}{ll}
1 & ,x=1 \\
(-1)^k & ,x=p_1\ldots p_k,i\neq j \Rightarrow p_i\neq p_j  \\
0 & ,x=other
\end{array} \right.
$$


容易发现莫比乌斯函数是积性函数。可以通过线性筛以线性时间复杂度预先算出。

下面说明莫比乌斯函数的主要用处：


$$
[g=1]=\sum_{d|g}\mu(d)
$$


# 欧拉函数

欧拉函数$\varphi(x)$表示的是小于x的正整数中与x互质的数的数目，特别的是$\varphi(1)=1$。

欧拉函数的通项公式：


$$
\varphi(x)=x\prod_{i=1}^k(1-\frac{1}{p_i})
$$


容易发现欧拉函数是积性函数，因此可以用线性筛直接处理。

欧拉函数的性质有以下两个：


$$
\sum_{d|n}\varphi(d)=n
$$


以及如果n与m互质，则有


$$
n^{\varphi(m)}=1
$$




# BZOJ2190

**题意**

[https://www.lydsy.com/JudgeOnline/problem.php?id=2190](https://www.lydsy.com/JudgeOnline/problem.php?id=2190)

**题解**

对于n，我们标记左下角左边为(0,0)，右上角坐标为(n-1,n-1)。

那么我们可以逐点统计，对于点(i,j)，其中i>0且j>0。若gcd(i,j)>1，则与(i/gcd(i,j),j/gcd(i,j))处于一条线上，因此我们可以仅仅统计这些互质的坐标对就可以防止重复统计问题。

但是总共有$n^2$个坐标，这有点多了，所以我们需要用别的方式进行加速。不说废话，直接列式子：



$$
\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j)=1]\\
\Rightarrow \sum_{i=1}^n\sum_{j=1}^n\sum_{d|gcd(i,j)}\mu(d)\\
\Rightarrow \sum_{d=1}^n\,u(d)\sum_{d|i}\sum_{d|j}1\\
\Rightarrow \sum_{d=1}^n\,u(d)\sum_{i=1}^{\lfloor \frac{n}{d} \rfloor}\sum_{j=1}^{\lfloor \frac{n}{d} \rfloor}\\
\Rightarrow \sum_{d=1}^n\lfloor \frac{n}{d} \rfloor^2\,u(d)
$$



这里莫比乌斯函数可以用欧拉筛预先处理，总共循环n次，时间复杂度为$O(n)$。

# BZOJ2818

**题意**

[https://www.lydsy.com/JudgeOnline/problem.php?id=2818](https://www.lydsy.com/JudgeOnline/problem.php?id=2818)

**题解**

记P为所有小于等于N的素数的集合，那么题目要我们求得是：


$$
\sum_{p\in P}\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j)=p]\\
\Rightarrow \sum_{p\in P}\sum_{i=1}^{\lfloor n/d \rfloor}\sum_{j=1}^{\lfloor n/d \rfloor}[gcd(i,j)=1]\\
\Rightarrow \sum_{p\in P}\sum_{i=1}^{\lfloor n/d \rfloor}(\sum_{j=1}^{i}[gcd(i,j)=1]+\sum_{j=i+1}^{\lfloor n/d \rfloor}[gcd(i,j)=1])\\
\Rightarrow \sum_{p\in P}(\sum_{i=1}^{\lfloor n/d \rfloor}\sum_{j=1}^{i}[gcd(i,j)=1]+\sum_{i=1}^{\lfloor n/d \rfloor}\sum_{j=i+1}^{\lfloor n/d \rfloor}[gcd(i,j)=1])\\
\Rightarrow \sum_{p\in P}(\sum_{i=1}^{\lfloor n/d \rfloor}\varphi(i)+\sum_{j=2}^{\lfloor n/d \rfloor}\sum_{i=1}^{j-1}[gcd(i,j)=1])\\
\Rightarrow \sum_{p\in P}(\sum_{i=1}^{\lfloor n/d \rfloor}\varphi(i)+\sum_{j=2}^{\lfloor n/d \rfloor}\varphi(j))\\
\Rightarrow \sum_{p\in P}(2\sum_{i=1}^{\lfloor n/d \rfloor}\varphi(i)-\varphi(1))\\
$$

我们可以用线性筛预处理欧拉函数，之后累计前缀后。之后遍历所有小于等于N的素数，累加就好了，实际复杂度O(N)。

# BZOJ1968

**题意**

[https://www.lydsy.com/JudgeOnline/problem.php?id=1968](https://www.lydsy.com/JudgeOnline/problem.php?id=1968)

**题解**

由于n非常小，所以解法很多。

解法1。


$$
\sum_{i=1}^nf(i)=\sum_{i=1}^n\sum_{d|i}1=\sum_{d=1}^n\sum_{i=1}^{\lfloor n/d \rfloor}1=\sum_{d=1}^n\lfloor n/d \rfloor
$$


之后可以暴力计算$O(n)$或数论分块$O(\sqrt{n})$。

解法2。

很容易发现函数$f$是积性函数，因此利用素数筛在线性时间复杂度内筛出，最后加总就好了。

# BZOJ3505

**题意**

[https://www.lydsy.com/JudgeOnline/problem.php?id=3505](https://www.lydsy.com/JudgeOnline/problem.php?id=3505)

**题解**

先考虑这样一个问题。点(x,y)与原点(0,0)构成的线段上有多少个坐标为整数的点。当(x,y)=(0,0)时，显然只有一个点。现在假设x>0且y>0，那么一共有1+gcd(x,y)个点。

接下来我们要定义函数$f(x,y)$表示从点(x,y)到点(0,0)的线段上坐标为整点的点的数目（不包括两端），可知$f(x,y)=0$当(x,y)=(0,0)，否则$f(x,y)=gcd(x,y)+1$。

要计算有多少个三角形，可以通过选取三个点的可能数减去三点共线的情况。三点共线的情况可以通过下面方法得到，枚举所有的点对，统计点对组成线段上有多少个整数点（不包含两端）。可以直接给出公式：
$$
\sum_{i=0}^n\sum_{j=0}^mf(i,j)(n-i)(m-j)([i\neq0\land j\neq0]+[i\neq0\lor j\neq0])
$$
枚举一下就好了，时间复杂度为$O(nm\log_2n)$。

# Codeforce1198F

**题意**

提供n个数，数的范围是\[1,1e9\]，将数分成两个非空集合，要求每个集合中元素的最大公约数为1，问是否可能。

**题解**

神奇的题目。由于数的范围不大，容易发现每个数最多有k=9个不同的素因子。如果一个集合的最大公约数为1，那么我们一定能通过排除集合部分元素，将集合的大小缩减到不超过$k+1$。

首先当n比较小的时候，我们可以直接枚举所有的划分方式，时间复杂度为$O((2^n+n)\log_2n)$。我们可以接受n=20的情况。

再考虑$n>20$的情况，我们打算构建两个可能的集合A、B。我们将第一个元素$a_1$放入到集合A中，可以保证假如有解，那么一定有一种方案，使得$a_2,a_3,\ldots, a_{k},a_{k+1}$中至少有一个元素属于集合B。我们不妨认为元素$a_2$属于集合B，那么我们可以将$a_1,a_2$进行质因子分解，之后通过动态规划来寻找可能的方案，时间复杂度为$O(n2^{2k})$。

这个时间复杂度是不可行的，但是我们注意到为了消除$a_0$的某个素因子$p$，我们需要向A加入一个不含因子$p$的数，由于B中最多还可以加入$k$个数，因此我们仅需要考虑前$k+1$不含因子$p$的数，这样至少会有一个不含因子$p$的数被加入到A中，从而消除A中的因子$p$。

对每个$a_1,a_2$的素因子都仅考虑前$k+1$个数，这样被考虑的数不会超过$2k(k+1)$个。我们证明如果没有找到一个划分的话，一定无解。假设在缩减后的集合中没有找到划分，但是原来的集合是存在划分的，这意味着我们必须向缩减后的集合加入至少一个被剔除的数x。假设这个数是被加入到集合A中，那么说明集合A中还剩余了某个素因子$p$没有被消除，且x不含有因子$p$。但是考虑到我们缩减后的集合中已经包含了$k+1$个不含$p$的数，而其中至少一个属于A，因此与前提相悖。

我们只需要分别判断当$a_2,a_3,\ldots, a_{k},a_{k+1}$属于集合B时是否有解，如果都没解，就说明无解。

# LUOGU1829

**题意**

[https://www.luogu.org/problem/P1829](https://www.luogu.org/problem/P1829)

**题解**

$$
\sum_{i=1}^n\sum_{j=1}^mlcm(i,j)\\
=\sum_{i=1}^n\sum_{j=1}^m\frac{ij}{gcd(i,j)}\\
=\sum_{g=1}\sum_{i=1}^n\sum_{j=1}^m\frac{ij}{g}[gcd(i,j)=g]\\
=\sum_{g=1}\sum_{i=1}^{\lfloor \frac{n}{g} \rfloor}\sum_{j=1}^{\lfloor \frac{m}{g} \rfloor}ijg[gcd(i,j)=1]\\
=\sum_{g=1}g\sum_{i=1}^{\lfloor \frac{n}{g} \rfloor}\sum_{j=1}^{\lfloor \frac{m}{g} \rfloor}ij\sum_{d|gcd(i,j)}\mu(d)\\
$$


# 参考文献

- （美）布鲁迪（Brualdi,R.A.）著.组合数学  第4版[M].机械工业出版社,2005:630.
- [欧拉函数 wiki](https://zh.wikipedia.org/wiki/欧拉函数)


---
categories: algorithm
layout: post
---

- Table
{:toc}
# LOJ2169

**题目**

[https://loj.ac/problem/2169](https://loj.ac/problem/2169)

**题解**

首先更新事件有环，我们将更新事件拆分成两个处理。因此现在只剩下一般的线段树操作了。

我们使用整体二分技术，要应用l~r之间的事件，我们先算出中点m，之后将l~m之间的事件应用在线段树上。之后我们查找每个国家的获得的陨石总数，如果超过就标记，否则不标记。

我们将不标记的国家，对其尝试应用m+1~r之间事件。之后我们撤销之前应用l~m之间事件带来的修改，之后对标记的国家，尝试应用l~m之间的事件。

如果l与r相等，就记录结果。

下面我们证明时间复杂度。复杂度分为两部分，一部分是判断国家是否得到了足够的陨石，我们知道每个区域在每个递归层次都只会统计一次，因此统计区域的总的时间复杂度为$O(m\log_2m\log_2k)$。接下来就是递归的时间复杂度了，假设$T(a,b)$表示处理a个国家和b个事件花费的时间，可以推出：


$$
T(a,b)=T(a_1,\frac{b}{2})+T(a-a_1,\frac{b}{2})+O(b
log_2m)=\ldots=O(b\log_2m\log_2k)
$$


总的时间复杂度为$O((m+k)\log_2m\log_2k)$。
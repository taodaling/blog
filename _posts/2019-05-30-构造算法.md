---
categories: algorithm
layout: post
---

- Table
{:toc}
# CF1168E

**题目大意：**

给出一组数$a_1,a_2,\ldots,a_{2^k}$，找到$0,1,\ldots,2^k-1$的两个排列p和q，使得$p_i\oplus q_i = a_i$。



**题解：**

首先容易看出必要条件：


$$
a_1\oplus a_2\oplus \ldots \oplus a_n=
(p_1\oplus q_1)\oplus \ldots \oplus (p_n\oplus q_n)=0
$$


假设现在有满足条件的p、q、a。那么我们可以选择两个不同的下标i、j，以及整数x，使得$a_i$变为$a_i\oplus x$，使得$a_j$变为$a_j\oplus x$。现在我们描述找到新的满足条件的置换的算法。

现在不满足条件的只有下标i和j。

找到下标t，使得$p_t=a_i\oplus q_i$。之后将公式进行下面转换：


$$
\left( \begin{array}{ccc}
p_t & q_t & a_t\\
p_i & q_i & a_i \\
p_j & q_j & a_j \\
\end{array} \right)
\Rightarrow
\left( \begin{array}{ccc}
p_i & q_j & a_t\\
p_t & q_i & a_i \\
p_j & q_t & a_j \\
\end{array} \right)
$$


这样需要修复的下标就只有t和j了。重复上面过程直到所有条件都被满足。

我们记矩阵第二行中的a的下标在整个流程中分别为$l_1,l_2,\ldots$，其中$l_1=i$，$l_2=t$。我们现在 证明对于任意$x\neq y$，有$l_x\neq l_y$，即每次被处理的下标不会重复。

我们假设序列中第一个重复点为$k$，即$l_k=l_x$且$x<k$。分两种情况讨论：

若$x>1$，那么我们有

$$
\left\{ \begin{array}{ccc}
a_{l_y}=p_{l_{y+1}}\oplus q_{l_{y-1}}=p_{l_y}\oplus q_{l_y}
\end{array} \right.
$$

由此得到


$$
a_{l_x}\oplus a_{l_{x+1}}\oplus \ldots \oplus a_{l_{k-1}}\\
=p_{l_{x+1}}\oplus\ldots\oplus p_{l_{k}}\oplus q_{l_{x-1}}\oplus \ldots \oplus q_{l_{k-2}}\\
=p_{l_x}\oplus \ldots \oplus p_{l_{k-1}}\oplus q_{l_x}\oplus \ldots \oplus q_{l_{k-1}}\\
\Rightarrow p_{l_{k}}\oplus q_{l_{x-1}}=p_{l_x}\oplus q_{l_{k-1}}\\
\Rightarrow  q_{l_{x-1}}=q_{l_{k-1}}\\
\Rightarrow l_{x-1}=l_{k-1}
$$


这里得到了一个悖论，$k-1$才是第一个重复点。因此假设不成立。

若$x=1$，那么我们直到在第$l_{k-1}$次流程中，转移为：


$$
\left( \begin{array}{ccc}
p_t & q_i & a_i\\
p_i & q_{l_{k-2}} & a_{l_{k-1}} \\
p_j & q_{l_{k-1}} & a_j \\
\end{array} \right)
\Rightarrow
\left( \begin{array}{ccc}
p_i & q_{l_{k-1}} & a_i\\
p_t & q_{l_{k-2}} & a_{l_{k-1}} \\
p_j & q_i & a_j \\
\end{array} \right)
$$


由于


$$
p_i\oplus q_{l_{k-1}}\oplus p_j \oplus q_i = a_i \oplus a_j=p_i\oplus q_j\oplus p_j \oplus q_i\\
\Rightarrow q_{l_{k-1}}=q_j\\
\Rightarrow l_{k-1}=l_2 = t\\
\Rightarrow p_t\oplus q_{l_{k-2}}=p_t\oplus q_j =a_t
$$


因此这意味着在第一次交换后就满足了条件，与假设相悖。

因此我们证明每次流程最多交换$n$个元素。

将p和q初始化为相同的排列。之后从$0,0,\ldots,0$出发，将该序列转换为$a_1,\ldots,a_n$。
---
layout: post
categories: technology
---

 * 目录
{:toc}

# CAP原理

CAP原理，又名为Brewer原理，声明最多同时提供下面三个保证中的二者：

- 一致性（Consistency）：每次读操作都可以读到最近一次修改后的新值，或者一个错误。
- 可用性（Available）：每个请求都能收到一个响应。
- 分区容错性（Partition tolerance）：不管消息在网络中怎么被丢弃或延迟，系统依旧能正常运作。

一般可用性和分区容错性对于客户体验影响较大，而一致性只需要保证最终一致性。


# 分布式事务解决方案

分布式事务中一般分为参与者和协调者，协调者是整个事务的中心，负责决定所有参与者的事务是否提交。

1. 简单的两阶段提交。在提交之前我们先轮询所有的参与者，保证他们都准备好了提交（要锁住必须的资源保证提交不会失败），之后一同提交。
这样发生提交失败的概率相对较低，如果出现失败，则必须手工修复。这种方式称为`TCC`，Try，Comfirm，Commit。

2. 带撤销操作的提交。要求参与者提供undo接口，用于撤销之前提交带来的影响。之后我们利用两阶段提交，
一旦发现有一个参与者提交失败，则调用其他已经提交成功的参与者的undo接口即可。这个算法称为`SAGA`算法。

3. 在两个参与者的情况，分别记为A和B。如果能保证B能正确提交，那么可以让A在确保自己提交后通知B进行提交。并且由于
网络原因可能A提交后，B未能及时收到通知，那么A就必须为B提供询问接口，B通过在超时后访问询问接口查询该次提交结果。
RocketMQ使用的就是这种方法。

---
categories: maven
layout: post
---

{:toc}



# Maven

## modules

modules用于定义模块，一个项目可以切分为多个子模块。每个子模块都有自己的pom文件。

```xml
<project>
	<modules>
		<module>api</module>
		<module>service</module>
		<module>dao</module>
	</modules>
</project>
```

利用mvn构建项目时，会同时构建其所有子模块。

## parent

一个pom可以设置另外一个pom为父pom，这样子pom会继承父pom的所有内容。

```xml
<project> 
	<parent>
		<groupId>com.daltao</groupId>
		<artifactId>everything-parent</artifactId>
		<version>1.0-SNAPSHOT</version>
	</parent>
</project>
```

## dependencyManagement

由于在父pom中定义依赖，会导致子pom必定拥有该依赖。为了消除不必要的依赖但是同时拥有继承的好处（比如关联依赖的版本一致），maven中提供了dependancyManagement元素。只有在显示地增加dependence时，才会利用到dependancyManagement中声明的值作为默认值。

```xml
<project>
	<dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>com.google.code.gson</groupId>
                <artifactId>gson</artifactId>
                <version>${gson.version}</version>
            </dependency>
            <dependency>
                <groupId>org.junit.jupiter</groupId>
                <artifactId>junit-jupiter-api</artifactId>
                <version>${junit.version}</version>
                <scope>test</scope>
            </dependency>
        </dependencies>
	</dependencyManagement>
</project>
```

### import

dependancyManagement中的依赖的scope可以设置为import，表示继承该pom中的dependancyManagement内容。

```xml
<project>
	<dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>com.google.code.gson</groupId>
                <artifactId>gson</artifactId>
                <version>${gson.version}</version>
				<type>pom</type>
				<scope>import</scope>
            </dependency>
        </dependencies>
	</dependencyManagement>
</project>
```



## scope

scope用于指定依赖的作用范围，类似于Java中注解的Retention。其可选值如下：

- compile: 默认，表示依赖将会在编译、运行时使用。
- provided: 表示依赖仅用于编译时。
- runtime: 表示依赖仅用于运行时（通过反射使用）
- test: 表示依赖仅用于测试用例的编译和运行

## properties

properties元素允许用户定义多个属性，而在其他地方可以利用`${propertyName}`来引用。

```xml
<project>
	<properties>
    	<gson.version>2.8.5</gson.version>
    </properties>
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>com.google.code.gson</groupId>
                <artifactId>gson</artifactId>
                <version>${gson.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
```

## build

### filters

filters标签中可以指定filter，filter则指定一个文件，文件为包含属性值的properties文件，相当于从中导入properties。

```xml
<project>
	<build>
        <filters>
          <filter>src/main/filters/${filter-file}.properties</filter>
        </filters>
    </build>
</project>
```

## resources

resources标签中可以包含resource标签，每个resource标签都可以指定某个目录下的一部分文件，并且利用properties替换这些文件中形如`${propertyName}`的内容。

```xml
<project>
    <build>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
                <includes>
                    <include>context.xml</include>
                </includes>
            </resource>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>false</filtering>
                <excludes>
                    <exclude>context.xml</exclude>
                </excludes>
            </resource>
        </resources>
    </build>
</project>
```

# plugin

### 生命周期

Maven有三套独立的生命周期：

- clean
- default
- site

clean的生命周期目的是清理项目，default生命周期的目的是构建项目，site的生命周期的目的是建立项目站点。

每个生命周期由一系列生命周期阶段组成，这些生命周期的阶段可以被用户单独调用。如果用户显式调用某个生命周期，这意味着该生命周期和其前置操作都会被执行，但是后续操作将被跳过。

```sh
mvn clean
mvn package
mvn install
```



#### clean生命周期

clean生命周期的目的是清理项目，其包含三个阶段：

1. **pre-clean**， 执行一些清理前的工作
2. **clean**，清理上一次构建生成的文件
3. **post-clean**，执行一些清理后需要完成的工作

#### default生命周期

default生命周期定义了真正构建时需要执行的所有步骤，其包含下面阶段：

1. **validate**
2. **initialize**
3. **generate-sources**
4. **process-sources**， 处理项目资源文件，一般是复制操作
5. **generaet-resources**
6. **compile**，编译项目的源代码，一般时编译java文件并将class文件输出到classpath中
7. **process-classes**
8. **generate-test-sources**
9. **process-test-sources**，处理项目测试资源文件，一般是复制操作
10. **process-test-resources**
11. **test-compile**，编译项目中的测试代码
12. **process-test-classes**
13. **test**，使用单元测试框架执行测试
14. **prepare-package**
15. **package**，接受编译好的代码，并打包成可发布的格式
16. **pre-integration-test**
17. **integration-test**
18. **post-integeration-test**
19. **verify**
20. **install**，将包安装到maven本地仓库
21. **deploy**，将最终的包复制到远程仓库

#### site生命周期

site生命周期的目的是建立和发布项目站点

1. **pre-site**，执行一些在生成项目站点之前需要完成的工作
2. **site**，生成项目站点文档
3. **post-site**，执行一些在生成项目站点之后需要完成的工作
4. **site-deploy**，将生成的项目站点发布到服务器上


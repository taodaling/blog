---
categories: algorithm
layout: post
---

- Table
{:toc}

# 期望的状态转移

考虑一个期望问题，我们从0向n出发，每一秒都向前等概率移动距离1，2（如果当前位置与n距离为1，则只能移动距离1）。问从0到n所需时间的期望值。

我们可以用f(i)表示从i到n所需步数的期望，利用期望的状态转移，可以得出：


$$
f(i)=\frac{1}{2}(f(i+1)+f(i+2))+1。
$$


之后我们可以以$O(n)$的时间复杂度计算结果。

# 带原地踏步的状态转移

之前讨论的期望的状态转移是带拓扑序的，因此我们可以很容易计算。现在稍微改变一下，我们现在每秒等概率移动0，1，2距离。这时候我们的函数就出现了自依赖。


$$
f(i)=\frac{1}{3}(f(i)+f(i+1)+f(i+2))+1
$$


我们可以将右边的\frac{1}{3}f(i)移动到左边进行计算。


$$
\frac{2}{3}f(i)=\frac{1}{3}(f(i+1)+f(i+2))+1\\
\Rightarrow f(i)=\frac{1}{2}(f(i+1)+f(i+2))+\frac{3}{2}
$$


之后就是简单的动态规划了。

# 带环的状态转移

修改问题，现在我们每秒有60%的几率向前走一步，40%的几率向后走一步，不允许离开$\[0,n\]$。问移动到n的期望步数。

这时候我们的公式为：


$$
f(i)=0.4f(i-1)+0.6f(i+1)+1
$$


要计算$f(i)$，我们必须先得知$f(i-1)$和$f(i+1)$，而要计算$f(i-1)$和$f(i+1)$，我们必须先得知$f(i)$，这就是先有鸡还是先有蛋的问题，陷入了死循环。

那么是否就无法计算期望呢。我们首先需要相信，期望一定是存在并且是不变的（即期望是唯一的）。之后我们可以推出一组公式：


$$
\left\{ 
\begin{array}{rcl}
f(0) & = & f(1)+1\\
f(1) & = & 0.4f(0)+0.6f(2)+1\\
...\\
f(n-1)&=&0.4f(n-2)+0.6f(n)+1\\
f(n)&=&0
\end{array} 
\right.
$$


对其稍作转换可以得到：


$$
\left\{ 
\begin{array}{lcr}
f(0) - f(1) & = &1\\
f(1) -0.4f(0)-0.6f(2) & = & 1\\
...\\
f(n-1)-0.4f(n-2)-0.6f(n)&=&1\\
f(n)&=&0
\end{array} 
\right.
$$


我们可以把其表示为矩阵和向量的乘积：


$$
\left(
\begin{array}{ccc}
1&-1 &0 & \dots&0 &0&0\\
-0.4&1&-0.6&\ldots&0&0&0\\
\ldots&\ldots&\ldots&\ldots&\ldots&\ldots&\ldots\\
0&0&0&\ldots&-0.4&1&-0.6\\
0&0&0&\ldots&0&0&1\\
\end{array}
\right)
\left(
\begin{array}{ccc}
f(0)\\
f(1)\\
\ldots\\
f(n-1)\\
f(n)
\end{array}
\right)
=
\left(
\begin{array}{ccc}
1\\
1\\
\ldots\\
1\\
0
\end{array}
\right)
$$


我们可以简单记为$Ax=y$。由于之前已经说过期望是唯一不变的，因此矩阵的秩一定为$n+1$，否则就会有多个解。我们可以对矩阵$A$取逆后将式子转换为$x=A^{-1}y$。这样就可以计算出期望序列$x$。



这样我们就能在时间复杂度$O(n^3)$内求解。



# 概率转期望

之前考虑的问题中，讨论概率是没有意义的，因为在足够多的时间过去后，我们一定会达到n，即概率为1。下面我们要讨论既有存在失败情况下游戏的胜利概率。

考虑这样一个问题，我们从1出发，如果到达n我们就获得胜利，游戏结束，如果到达0，我们就失败，游戏结束。问胜利的概率为多少。

如果我们对概率进行转移，我们会发现完全无法解决，比如抵达n的概率，显然与抵达n-1的概率相关，从而可以推出和抵达1的概率有关。那么我们抵达1的概率是多少？100%，还是其它。如果我们认为是100%，就会发现如果我们从2回到1，抵达1的概率就会超出100%，这显然是有问题的。

我们可以定义一个随机变量X，X取的是实验中我们处于位置n的次数。由于X只有两种取值0，1，那么我们可以推出


$$
E(X)=1\cdot p(X=1)+0\cdot p(X=0)=p(X=1)
$$


而$p(X=1)$实际上就是游戏胜利的概率，因此我们可以通过计算$E(X)$得到$p(X=1)$。

而期望的公式怎么建立我们之前就讨论过了，需要注意的是，不可能从$f(0)$和$f(n)$再次进行转移，以及初始时我们处于位置1，因此$f(1)=0.4f(2)+1$。而对于其余值，应该为


$$
f(i)=0.4f(i+1)-0.6f(i-1)
$$

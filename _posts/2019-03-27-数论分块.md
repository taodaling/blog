---
categories: algorithm
layout: post
---

面对下面这样的函数：


$$
\sum_{i=1}^{n}f(\lfloor{\frac{n}{i}}\rfloor)
$$


其中计算$f(x)$的时间复杂度为$O(1)$，求问你可以多快获得结果。

很显然暴力计算的时间复杂度将是$O(n)$。虽然称不上优秀，但是至少简单。但是假如$n$很大，那么计算起来就是一件轻松的事情了。

```java
for(int i = 1; i <= n; i++)
{
    sum += f(n / i);
}
```

通过观察可以发现存在很多$i<j$但$\lfloor{\frac{n}{i}}\rfloor=\lfloor{\frac{n}{j}}\rfloor$的情况，比如当$n=4,i=3,j=4$。

我们称$\lfloor{\frac{n}{i}}\rfloor$为$i$的下整值。记下整值为x的所有的i的集合$\{i_1,i_2,\ldots,i_k\}$为$x$的导出集合，记作的导出集合，记作$E(x)$。

并且很容易发现拥有相同下整值的数值往往是连续的。实际上，若$i<j$且$\lfloor{\frac{n}{i}}\rfloor=\lfloor{\frac{n}{j}}\rfloor$成立时，对于任意$i\leq x \leq j$，都有$\lfloor{\frac{n}{i}}\rfloor \leq \lfloor{\frac{n}{x}}\rfloor \leq \lfloor{\frac{n}{j}}\rfloor$，即$\lfloor{\frac{n}{i}}\rfloor = \lfloor{\frac{n}{x}}\rfloor = \lfloor{\frac{n}{j}}\rfloor$。

我们可以将拥有相同下整值的值合并在一起计算。由于$\lfloor\frac{n}{\lfloor\frac{n}{i}\rfloor}\rfloor$是$\lfloor\frac{n}{i}\rfloor$的导出集合中的最大值，因此我们可以很快地计算某个数的导出集合的边界。


$$
\min(E(x))=\lfloor\frac{n}{x-1}\rfloor+1\\
\max(E(x))=\lfloor\frac{n}{x}\rfloor
$$


我们要做的就是枚举可能的下整值，并合并计算。

```java
for(int i = 1, r; i <= n; i = r + 1)
{
    r = n / (n / i);
    sum += f(n / i) * (r - i + 1)
}
```

上面我们就优化了原先的代码，加入了合并计算的能力。

代码优化是优化了，但是我们现在的时间复杂度究竟是多少呢？很显然时间复杂度为$O(B)$，其中$B$是总共的分块数目，同样也是可能的下整值数量。考虑到对于$1,2,\ldots,\sqrt{n}$，它们的下整值落在$\{\lfloor\frac{n}{1}\rfloor,\lfloor\frac{n}{2}\rfloor,\ldots,\lfloor\frac{n}{\sqrt{n}}\rfloor\}$，而对于任意，而对于任意$i>\sqrt{n}$，其下整值一定落在，其下整值一定落在$\{1,2,\ldots,\sqrt{n}\}$中。因此可能的下整值最多有中。因此可能的下整值最多有$2\sqrt{n}$种。借此我们得到了时间复杂度的上限。借此我们得到了时间复杂度的上限$O(\sqrt{n})$。